<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>فانوس رمضان 2026</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/lucide-static/0.321.0/lucide.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap');
        body { font-family: 'Cairo', sans-serif; background-color: #050B18; color: white; overflow-x: hidden; }
        .glass { background: rgba(10, 18, 36, 0.9); backdrop-filter: blur(12px); border-bottom: 1px solid rgba(255,255,255,0.1); }
        .tab-active { background: rgba(245, 158, 11, 0.15); color: #f59e0b; border: 1px solid rgba(245, 158, 11, 0.3); }
        .hidden-section { display: none; }
        .tasbih-card { transition: all 0.2s ease; border: 1px solid rgba(255,255,255,0.05); cursor: pointer; }
        .tasbih-card:active { transform: scale(0.95); background: rgba(245, 158, 11, 0.1); }

        /* تنسيق شريط القرآن */
        #quran-slider {
            -webkit-appearance: none;
            width: 100%; height: 5px; background: #1e293b; border-radius: 10px;
            background-image: linear-gradient(#f59e0b, #f59e0b); background-repeat: no-repeat;
            background-size: 0% 100%; cursor: pointer; outline: none; direction: ltr !important;
        }
        #quran-slider::-webkit-slider-thumb {
            -webkit-appearance: none; height: 14px; width: 14px; border-radius: 50%;
            background: white; box-shadow: 0 0 8px rgba(0,0,0,0.4); cursor: pointer;
        }

        /* تمييز الصف الخاص باليوم الحالي */
        .today-row {
            background-color: rgba(245, 158, 11, 0.2) !important; /* خلفية برتقالية شفافة */
            border: 2px solid #f59e0b !important; /* إطار برتقالي */
            transition: all 0.5s ease;
        }

        .today-row td:first-child::after {
            content: " (اليوم)";
            font-size: 8px;
            vertical-align: middle;
            display: block;
            color: #f59e0b;
        }
    </style>
</head>
<body class="pb-20">

    <audio id="athan-audio" preload="auto">
        <source src="adhan.mp3" type="audio/mpeg">
    </audio>

    <div id="audio-overlay" class="fixed inset-0 z-[200] flex items-center justify-center bg-black/95">
        <div class="text-center p-8 bg-[#0A1224] rounded-[2.5rem] border border-amber-500/30 max-w-sm mx-4">
            <i data-lucide="moon-star" class="text-amber-500 w-16 h-16 mx-auto mb-6"></i>
            <h2 class="text-2xl font-bold mb-4 text-amber-500">رمضان 2026</h2>
            <p class="text-white/70 mb-8 text-sm">اضغط للتفعيل لضمان عمل الأذان التلقائي والعداد والقرآن.</p>
            <button onclick="enableAudioAndStart()" class="w-full py-4 bg-amber-500 text-[#050B18] font-black rounded-2xl text-lg hover:bg-amber-400 transition-colors">تفعيل ودخول</button>
        </div>
    </div>

    <header class="sticky top-0 p-4 flex justify-between items-center glass z-[150]">
        <div class="flex items-center gap-3">
            <div class="w-10 h-10 bg-amber-500 rounded-xl flex items-center justify-center"><i data-lucide="layout-grid" class="text-[#050B18]"></i></div>
            <h1 class="text-lg font-bold text-amber-500">فانوس رمضان</h1>
        </div>
        <div class="flex items-center gap-2">
            <button id="stop-btn" onclick="stopAthan()" class="hidden bg-red-500/20 text-red-400 border border-red-500/30 px-3 py-1.5 rounded-lg text-xs font-bold">إيقاف الأذان</button>
            <button onclick="testAthan()" class="bg-amber-500/10 text-amber-500 border border-amber-500/20 px-3 py-1.5 rounded-lg text-xs font-bold">تجربة الأذان</button>
            <div id="live-clock" class="text-lg font-mono font-bold text-amber-400 ml-2">00:00:00</div>
        </div>
    </header>

    <main class="max-w-5xl mx-auto p-4 space-y-6">
        <section class="rounded-[2.5rem] bg-[#0A1224] border border-white/5 p-8 text-center shadow-2xl">
            <div class="text-amber-400 text-sm font-bold mb-2 uppercase tracking-widest">المتبقي لأذان <span id="prayer-name">--</span></div>
            <h2 id="countdown-timer" class="text-6xl md:text-8xl font-black font-mono mb-2 text-white">00:00:00</h2>
            <div id="next-prayer-time" class="text-white/40 text-sm font-mono bg-white/5 inline-block px-4 py-1 rounded-full">موعد الصلاة: --:--</div>
        </section>

        <div class="flex p-1 bg-white/5 rounded-2xl border border-white/10">
            <button onclick="switchTab('imsakia')" id="tab-imsakia" class="flex-1 py-3 rounded-xl tab-active font-bold transition-all">الجدول</button>
            <button onclick="switchTab('quran')" id="tab-quran" class="flex-1 py-3 rounded-xl text-white/40 font-bold transition-all">القرآن</button>
            <button onclick="switchTab('subha')" id="tab-subha" class="flex-1 py-3 rounded-xl text-white/40 font-bold transition-all">السبحة</button>
        </div>

        <div id="content-imsakia" class="bg-[#0A1224] rounded-[2rem] border border-white/5 overflow-hidden">
            <div class="overflow-x-auto">
                <table class="w-full text-center text-[10px] md:text-xs">
                    <thead class="bg-white/10 text-amber-500 font-bold">
                        <tr>
                            <th class="p-3">رمضان</th>
                            <th class="p-3">التاريخ</th>
                            <th class="p-3">الإمساك</th>
                            <th class="p-3">الفجر</th>
                            <th class="p-3">الشروق</th>
                            <th class="p-3">الظهر</th>
                            <th class="p-3">المغرب</th>
                            <th class="p-3">منتصف الليل</th>
                        </tr>
                    </thead>
                    <tbody id="imsakia-body" class="divide-y divide-white/5 text-white/70"></tbody>
                </table>
            </div>
        </div>

        <div id="content-quran" class="hidden-section">
            <div class="bg-[#0A1224] rounded-[2.5rem] border border-white/5 p-10 text-center shadow-2xl">
                <h3 class="text-xl font-bold mb-10 text-amber-500">ختمة القرآن الكريم</h3>
                <audio id="quran-player" src="https://github.com/ossamasal2012/q/releases/download/v1.0/q.webm"></audio>
                <div class="flex items-center justify-center gap-6 mb-12">
                    <button onclick="skipTime(-10)" class="p-3 bg-white/5 rounded-full text-white/50"><i data-lucide="rotate-ccw"></i></button>
                    <button onclick="toggleQuran()" class="w-16 h-16 bg-amber-500 rounded-full flex items-center justify-center text-[#050B18] shadow-lg"><i id="quran-icon" data-lucide="play"></i></button>
                    <button onclick="skipTime(10)" class="p-3 bg-white/5 rounded-full text-white/50"><i data-lucide="rotate-cw"></i></button>
                </div>
                <div class="px-2">
                    <input type="range" id="quran-slider" value="0" min="0" step="1">
                    <div class="flex justify-between mt-3 text-[10px] font-mono text-white/30" style="direction: ltr;">
                        <span id="current-time">00:00:00</span>
                        <span id="duration-time">00:00:00</span>
                    </div>
                </div>
            </div>
        </div>

        <div id="content-subha" class="hidden-section space-y-4">
            <div id="subha-list" class="grid grid-cols-1 md:grid-cols-2 gap-4"></div>
            <button onclick="resetTasbih()" class="w-full py-4 text-white/20 text-xs">تصفير العدادات</button>
        </div>
    </main>

    <script src="https://unpkg.com/lucide@latest"></script>
    <script>
        const imsakiaData = [
            { day: 1, date: '19 شباط', mDate: '2026-02-19', imsak: '5:09', fajr: '5:19', sunrise: '6:42', dhuhr: '12:17', maghrib: '6:07', midnight: '11:35' },
            { day: 2, date: '20 شباط', mDate: '2026-02-20', imsak: '5:08', fajr: '5:18', sunrise: '6:41', dhuhr: '12:16', maghrib: '6:07', midnight: '11:35' },
            { day: 3, date: '21 شباط', mDate: '2026-02-21', imsak: '5:07', fajr: '5:17', sunrise: '6:40', dhuhr: '12:16', maghrib: '6:08', midnight: '11:35' },
            { day: 4, date: '22 شباط', mDate: '2026-02-22', imsak: '5:06', fajr: '5:16', sunrise: '6:39', dhuhr: '12:16', maghrib: '6:09', midnight: '11:35' },
            { day: 5, date: '23 شباط', mDate: '2026-02-23', imsak: '5:05', fajr: '5:15', sunrise: '6:38', dhuhr: '12:16', maghrib: '6:10', midnight: '11:35' },
            { day: 6, date: '24 شباط', mDate: '2026-02-24', imsak: '5:04', fajr: '5:14', sunrise: '6:37', dhuhr: '12:16', maghrib: '6:11', midnight: '11:35' },
            { day: 7, date: '25 شباط', mDate: '2026-02-25', imsak: '5:03', fajr: '5:13', sunrise: '6:36', dhuhr: '12:16', maghrib: '6:11', midnight: '11:35' },
            { day: 8, date: '26 شباط', mDate: '2026-02-26', imsak: '5:02', fajr: '5:12', sunrise: '6:35', dhuhr: '12:16', maghrib: '6:12', midnight: '11:35' },
            { day: 9, date: '27 شباط', mDate: '2026-02-27', imsak: '5:01', fajr: '5:11', sunrise: '6:34', dhuhr: '12:15', maghrib: '6:13', midnight: '11:35' },
            { day: 10, date: '28 شباط', mDate: '2026-02-28', imsak: '5:00', fajr: '5:10', sunrise: '6:32', dhuhr: '12:15', maghrib: '6:14', midnight: '11:35' },
            { day: 11, date: '1 آذار', mDate: '2026-03-01', imsak: '4:58', fajr: '5:08', sunrise: '6:30', dhuhr: '12:15', maghrib: '6:15', midnight: '11:34' },
            { day: 12, date: '2 آذار', mDate: '2026-03-02', imsak: '4:57', fajr: '5:07', sunrise: '6:29', dhuhr: '12:15', maghrib: '6:16', midnight: '11:34' },
            { day: 13, date: '3 آذار', mDate: '2026-03-03', imsak: '4:56', fajr: '5:06', sunrise: '6:28', dhuhr: '12:15', maghrib: '6:17', midnight: '11:34' },
            { day: 14, date: '4 آذار', mDate: '2026-03-04', imsak: '4:54', fajr: '5:04', sunrise: '6:27', dhuhr: '12:14', maghrib: '6:18', midnight: '11:34' },
            { day: 15, date: '5 آذار', mDate: '2026-03-05', imsak: '4:53', fajr: '5:03', sunrise: '6:25', dhuhr: '12:14', maghrib: '6:18', midnight: '11:33' },
            { day: 16, date: '6 آذار', mDate: '2026-03-06', imsak: '4:52', fajr: '5:02', sunrise: '6:24', dhuhr: '12:14', maghrib: '6:19', midnight: '11:33' },
            { day: 17, date: '7 آذار', mDate: '2026-03-07', imsak: '4:51', fajr: '5:01', sunrise: '6:23', dhuhr: '12:14', maghrib: '6:20', midnight: '11:33' },
            { day: 18, date: '8 آذار', mDate: '2026-03-08', imsak: '4:50', fajr: '5:00', sunrise: '6:22', dhuhr: '12:13', maghrib: '6:21', midnight: '11:33' },
            { day: 19, date: '9 آذار', mDate: '2026-03-09', imsak: '4:48', fajr: '4:58', sunrise: '6:21', dhuhr: '12:13', maghrib: '6:21', midnight: '11:32' },
            { day: 20, date: '10 آذار', mDate: '2026-03-10', imsak: '4:47', fajr: '4:57', sunrise: '6:19', dhuhr: '12:13', maghrib: '6:22', midnight: '11:32' },
            { day: 21, date: '11 آذار', mDate: '2026-03-11', imsak: '4:46', fajr: '4:56', sunrise: '6:18', dhuhr: '12:13', maghrib: '6:23', midnight: '11:32' },
            { day: 22, date: '12 آذار', mDate: '2026-03-12', imsak: '4:45', fajr: '4:55', sunrise: '6:17', dhuhr: '12:12', maghrib: '6:23', midnight: '11:32' },
            { day: 23, date: '13 آذار', mDate: '2026-03-13', imsak: '4:43', fajr: '4:53', sunrise: '6:16', dhuhr: '12:12', maghrib: '6:24', midnight: '11:31' },
            { day: 24, date: '14 آذار', mDate: '2026-03-14', imsak: '4:42', fajr: '4:52', sunrise: '6:14', dhuhr: '12:12', maghrib: '6:25', midnight: '11:31' },
            { day: 25, date: '15 آذار', mDate: '2026-03-15', imsak: '4:41', fajr: '4:51', sunrise: '6:13', dhuhr: '12:12', maghrib: '6:26', midnight: '11:31' },
            { day: 26, date: '16 آذار', mDate: '2026-03-16', imsak: '4:39', fajr: '4:49', sunrise: '6:12', dhuhr: '12:11', maghrib: '6:26', midnight: '11:30' },
            { day: 27, date: '17 آذار', mDate: '2026-03-17', imsak: '4:38', fajr: '4:48', sunrise: '6:11', dhuhr: '12:11', maghrib: '6:27', midnight: '11:30' },
            { day: 28, date: '18 آذار', mDate: '2026-03-18', imsak: '4:37', fajr: '4:47', sunrise: '6:09', dhuhr: '12:11', maghrib: '6:28', midnight: '11:30' },
            { day: 29, date: '19 آذار', mDate: '2026-03-19', imsak: '4:35', fajr: '4:45', sunrise: '6:08', dhuhr: '12:10', maghrib: '6:28', midnight: '11:29' },
            { day: 30, date: '20 آذار', mDate: '2026-03-20', imsak: '4:34', fajr: '4:44', sunrise: '6:07', dhuhr: '12:10', maghrib: '6:29', midnight: '11:29' }
        ];

        const azkar = ["أستغفر الله", "سبحان الله وبحمده", "لا إله إلا الله", "الله أكبر", "اللهم صل على محمد"];
        const audio = document.getElementById('athan-audio');
        const qp = document.getElementById('quran-player');
        const slider = document.getElementById('quran-slider');

        function stopAthan() { audio.pause(); audio.currentTime = 0; document.getElementById('stop-btn').classList.add('hidden'); }
        function testAthan() { audio.play(); document.getElementById('stop-btn').classList.remove('hidden'); }

        async function enableAudioAndStart() {
            try { await audio.play(); audio.pause(); audio.currentTime = 0; } catch(e){}
            document.getElementById('audio-overlay').style.display = 'none';
            setInterval(updateCore, 1000);
            initApp();
        }

        function parseTime(t, isPM) {
            const [h, m] = t.split(':').map(Number);
            let d = new Date();
            let hh = isPM && h < 12 ? h + 12 : (!isPM && h === 12 ? 0 : h);
            d.setHours(hh, m, 0, 0);
            return d;
        }

        function updateCore() {
            const now = new Date();
            document.getElementById('live-clock').innerText = now.toLocaleTimeString('ar-EG', {hour12:false});
            
            const dateKey = `${now.getFullYear()}-${String(now.getMonth()+1).padStart(2,'0')}-${String(now.getDate()).padStart(2,'0')}`;
            const today = imsakiaData.find(d => d.mDate === dateKey) || imsakiaData[0];

            const prayers = [
                { name: 'الفجر', t: parseTime(today.fajr, false) },
                { name: 'الظهر', t: parseTime(today.dhuhr, true) },
                { name: 'المغرب', t: parseTime(today.maghrib, true) }
            ];

            let next = prayers.find(p => p.t > now);
            if (!next) { 
                next = { ...prayers[0], t: new Date(prayers[0].t.getTime() + 86400000) }; 
            }

            const diff = next.t - now;
            const h = Math.floor(diff / 3600000);
            const m = Math.floor((diff % 3600000) / 60000);
            const s = Math.floor((diff % 60000) / 1000);

            document.getElementById('prayer-name').innerText = next.name;
            document.getElementById('countdown-timer').innerText = `${String(h).padStart(2,'0')}:${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
            document.getElementById('next-prayer-time').innerText = "موعد الصلاة: " + next.t.toLocaleTimeString('ar-EG', {hour:'2-digit', minute:'2-digit'});

            if (h === 0 && m === 0 && s === 0) { 
                audio.play(); 
                document.getElementById('stop-btn').classList.remove('hidden'); 
            }
        }

        function initApp() {
            // كود تمييز اليوم الحالي في الجدول
            const now = new Date();
            const todayDateKey = `${now.getFullYear()}-${String(now.getMonth()+1).padStart(2,'0')}-${String(now.getDate()).padStart(2,'0')}`;

            const tbody = document.getElementById('imsakia-body');
            tbody.innerHTML = imsakiaData.map(r => {
                const isToday = r.mDate === todayDateKey ? 'today-row' : '';
                return `
                    <tr class="border-b border-white/5 ${isToday}">
                        <td class="p-3 text-amber-500 font-bold">${r.day}</td>
                        <td class="p-3">${r.date}</td>
                        <td class="p-3 opacity-50 font-mono">${r.imsak}</td>
                        <td class="p-3 font-mono">${r.fajr}</td>
                        <td class="p-3 opacity-50 font-mono">${r.sunrise}</td>
                        <td class="p-3 font-mono">${r.dhuhr}</td>
                        <td class="p-3 font-bold text-amber-400 font-mono">${r.maghrib}</td>
                        <td class="p-3 opacity-50 font-mono">${r.midnight}</td>
                    </tr>
                `;
            }).join('');

            const sList = document.getElementById('subha-list');
            sList.innerHTML = azkar.map((z, i) => {
                const saved = localStorage.getItem(`tasbih_${i}`) || 0;
                return `<div onclick="inc(${i})" class="tasbih-card bg-white/5 p-6 rounded-[2rem] flex justify-between items-center">
                    <span class="text-sm font-bold">${z}</span>
                    <span id="c_${i}" class="text-2xl font-black text-amber-500">${saved}</span>
                </div>`;
            }).join('');
            
            lucide.createIcons();
        }

        function inc(i) {
            let el = document.getElementById(`c_${i}`);
            let newVal = parseInt(el.innerText) + 1;
            el.innerText = newVal;
            localStorage.setItem(`tasbih_${i}`, newVal);
            if (navigator.vibrate) navigator.vibrate(40);
        }

        function resetTasbih() {
            if(confirm("تصفير جميع العدادات؟")) {
                azkar.forEach((_, i) => localStorage.setItem(`tasbih_${i}`, 0));
                initApp();
            }
        }

        qp.ontimeupdate = () => {
            if (!isNaN(qp.duration)) {
                const prog = (qp.currentTime / qp.duration) * 100;
                slider.value = qp.currentTime; slider.max = qp.duration;
                slider.style.backgroundSize = prog + '% 100%';
                document.getElementById('current-time').innerText = formatTime(qp.currentTime);
                document.getElementById('duration-time').innerText = formatTime(qp.duration);
            }
        };

        slider.oninput = () => {
            qp.currentTime = slider.value;
            slider.style.backgroundSize = (slider.value / qp.duration) * 100 + '% 100%';
        };

        function toggleQuran() {
            const icon = document.getElementById('quran-icon');
            if (qp.paused) { qp.play(); icon.setAttribute('data-lucide', 'pause'); } 
            else { qp.pause(); icon.setAttribute('data-lucide', 'play'); }
            lucide.createIcons();
        }

        function skipTime(s) { qp.currentTime += s; }
        
        function formatTime(sec) {
            const h = Math.floor(sec / 3600);
            const m = Math.floor((sec % 3600) / 60);
            const s = Math.floor(sec % 60);
            return `${String(h).padStart(2,'0')}:${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
        }

        function switchTab(t) {
            ['imsakia', 'subha', 'quran'].forEach(id => {
                document.getElementById(`content-${id}`).classList.toggle('hidden-section', id !== t);
                document.getElementById(`tab-${id}`).className = id === t ? 'flex-1 py-3 rounded-xl tab-active font-bold transition-all' : 'flex-1 py-3 rounded-xl text-white/40 font-bold transition-all';
            });
            lucide.createIcons();
        }

        window.onload = () => lucide.createIcons();
    </script>
</body>
</html>
