<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>فانوس رمضان - الإمساكية</title>

<script src="https://cdn.tailwindcss.com"></script>
<script src="https://unpkg.com/lucide@latest"></script>

<style>
body{font-family:'Cairo',sans-serif;background:#050B18;color:white}
.hidden-section{display:none}
.tab-active{background:rgba(245,158,11,.1);color:#f59e0b}
</style>
</head>
<body class="pb-20">

<!-- إشعار -->
<div id="notification" class="fixed top-5 left-1/2 -translate-x-1/2 bg-amber-500 text-black px-6 py-3 rounded-2xl shadow-lg hidden z-50 font-bold"></div>

<!-- زر إيقاف الأذان -->
<button id="stop-adhan"
class="fixed bottom-6 left-1/2 -translate-x-1/2 bg-red-600 hover:bg-red-700 px-6 py-3 rounded-2xl hidden z-50 font-bold shadow-lg">
إيقاف الأذان
</button>

<header class="p-6 flex justify-between">
<div>
<h1 class="text-2xl font-black text-amber-400">فانوس رمضان</h1>
<p id="header-date"></p>
</div>
<div id="live-clock" class="text-2xl font-mono text-amber-400"></div>
</header>

<main class="max-w-4xl mx-auto p-6 space-y-6">

<section class="bg-[#0A1224] p-8 rounded-3xl">
<div class="text-center space-y-4">
<p>المتبقي لأذان <span id="prayer-name">--</span></p>
<h2 id="countdown-timer" class="text-5xl font-mono">00:00:00</h2>
<p>الساعة <span id="prayer-time">--:--</span></p>
</div>
<div class="h-2 bg-white/10 mt-6 rounded-full overflow-hidden">
<div id="progress-bar" class="h-full bg-amber-500" style="width:0%"></div>
</div>
</section>

</main>

<audio id="adhan-audio" src="adhan.mp3" preload="auto"></audio>

<script>
const imsakiaData = [
{day:1,mDate:'2026-02-19',fajr:'05:19',maghrib:'18:07'},
{day:2,mDate:'2026-02-20',fajr:'05:18',maghrib:'18:07'},
{day:3,mDate:'2026-02-21',fajr:'05:17',maghrib:'18:08'}
];

let adhanEnabled=false;
let lastAdhanMinute=null;
let lastNotifyMinute=null;

function showNotification(text){
const box=document.getElementById("notification");
box.innerText=text;
box.classList.remove("hidden");
setTimeout(()=>box.classList.add("hidden"),5000);
}

function initApp(){

// تفعيل الصوت أول ضغطة
document.body.addEventListener("click",()=>{
adhanEnabled=true;
const a=document.getElementById("adhan-audio");
a.play().then(()=>{a.pause();a.currentTime=0;});
},{once:true});

const today=new Date().toISOString().split("T")[0];
let todayData=imsakiaData.find(d=>d.mDate===today) || imsakiaData[0];

document.getElementById("header-date").innerText=
`اليوم ${todayData.day} رمضان`;

setInterval(()=>{

const now=new Date();
document.getElementById("live-clock").innerText=
now.toLocaleTimeString("ar-EG",{hour12:false});

const prayers=[
{name:"الفجر",time:todayData.fajr},
{name:"المغرب",time:todayData.maghrib}
];

let next=null;

for(let p of prayers){
const [h,m]=p.time.split(":").map(Number);
const d=new Date();
d.setHours(h,m,0,0);
if(d>now){next={...p,date:d};break;}
}

if(!next){
const [h,m]=todayData.fajr.split(":").map(Number);
const d=new Date();
d.setDate(d.getDate()+1);
d.setHours(h,m,0,0);
next={name:"الفجر (غداً)",time:todayData.fajr,date:d};
}

const diff=next.date-now;
const h=Math.floor(diff/3600000);
const m=Math.floor((diff%3600000)/60000);
const s=Math.floor((diff%60000)/1000);

document.getElementById("prayer-name").innerText=next.name;
document.getElementById("prayer-time").innerText=next.time;
document.getElementById("countdown-timer").innerText=
`${String(h).padStart(2,"0")}:${String(m).padStart(2,"0")}:${String(s).padStart(2,"0")}`;

// تقدم اليوم
const total=86400;
const passed=now.getHours()*3600+now.getMinutes()*60+now.getSeconds();
document.getElementById("progress-bar").style.width=
`${(passed/total)*100}%`;

// إشعار قبل 5 دقائق
if(diff<=300000 && diff>295000){
if(lastNotifyMinute!==now.getMinutes()){
showNotification(`تبقى 5 دقائق على أذان ${next.name}`);
lastNotifyMinute=now.getMinutes();
}
}

// تشغيل الأذان
if(diff<=1000 && diff>0){
if(lastAdhanMinute!==now.getMinutes()){
if(adhanEnabled){
const audio=document.getElementById("adhan-audio");
audio.currentTime=0;
audio.play();
document.getElementById("stop-adhan").classList.remove("hidden");
showNotification(`حان الآن أذان ${next.name}`);
}
lastAdhanMinute=now.getMinutes();
}
}

},1000);

document.getElementById("stop-adhan").onclick=()=>{
const audio=document.getElementById("adhan-audio");
audio.pause();
audio.currentTime=0;
document.getElementById("stop-adhan").classList.add("hidden");
};

}

window.onload=initApp;
</script>

</body>
</html>
